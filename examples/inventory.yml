all:
  children:
    # defines which host will perform the build
    # only the first host in this group will ever be used
    docker_build_hosts:
      hosts:
        # for these examples we'll build images on the same host ansible is running on
        localhost:
          connection: local

    docker_build_images:
      # these variables are common to all images we build
      vars:
        # get this URL from the download page's "Got wget?" command
        # or any accessible location that hosts the splunk .tgz
        # including file:// locations
        # 7.3.4 included here as an example
        splunk_tgz_url: |-
          https://www.splunk.com/page/download_track?file=7.3.4/linux/splunk-7.3.4-13e97039fb65-Linux-x86_64.tgz&ac=&wget=true&name=wget&platform=Linux&architecture=x86_64&version=7.3.4&product=splunk&typed=release

        # set the splunk admin user/password for user-seed.conf
        splunk_admin_user: admin
        splunk_admin_password: pleasechangeme
        # you could use splunk_admin_password_hash for a pre-hashed password
        # splunk_admin_password_hash = <your password hash>

        # specify a license master, but just a dummy here
        license_master_uri: https://example.org:8089

        # if you need to escalate privilege to a different user to perform docker operations, specify it here
        # docker_become_user:

      # each image we want to build is defined as a host, and thus can make use of ansible's variable precedence
      hosts:

        # don't do much other than run splunk
        hello_swarm_forwarder:
          version: 1.0.0

        # enable healthcheck for the _internal index
        internal_healthcheck_forwarder:
          version: 1.0.0
          # perform the check every 30 seconds
          healthcheck_interval_seconds: 30

          # expect to see non-zero thruput for the _internal index no older than 60 seconds
          # the metrics healthcheck lets you pick the group and series to monitor in metrics.log
          healthcheck_metrics_group: per_index_thruput
          healthcheck_metrics_series: _internal
          healthcheck_allowed_age_seconds: 60
