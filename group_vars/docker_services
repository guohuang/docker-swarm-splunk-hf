docker_image_name: "{{ image_name | default(inventory_hostname) }}"
repository: "{{ registry }}/{{ repository_path }}"
repository_deploy_image: "{% if repository is defined %}{{ repository }}/{% endif %}{{ docker_image_name }}:{{ tags.deploy }}"

# create a config for healthcheck to be converted to json
healthcheck_config:
    group: "{{ healthcheck_metrics_group }}"
    series: "{{ healthcheck_metrics_series }}"
    allowed_age_seconds: "{{ healthcheck_allowed_age_seconds }}"
    path: "{{ splunk_home }}/var/log/splunk/metrics.log*"

# content needs to be in a predictable state, so force sorting when converting to json
healthcheck_config_json: "{{ healthcheck_config | to_json(sort_keys=True) | b64encode }}"

# this name needs to correspond to the template filename metrics_healthcheck/healthcheck_config.json
healthcheck_config_filename: "{{ splunk_home }}/healthcheck_config.json"

# role_docker_configs are used by docker_service_deploy and docker_image_build
role_docker_configs:
    - name: "{{ inventory_hostname }}_healthcheck_config"
      filename: "{{ healthcheck_config_filename }}"
      uid: "{{ splunk_user_id }}"
      gid: "{{ splunk_group_id }}"
      # if content exists a docker config will be created/updated
      # if not, an already-defined docker config will be used
      content: "{{ healthcheck_config_json }}"
      content_is_b64: yes

# combine role, common, and host docker configs
docker_configs: "{{ role_docker_configs + common_docker_configs + host_docker_configs }}"
